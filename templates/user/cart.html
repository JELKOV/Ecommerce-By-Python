{% extends "base/layout.html" %}

{% block title %}ğŸ›’ ì¥ë°”êµ¬ë‹ˆ - My Shop{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1 class="text-center mb-4">ğŸ›’ ì¥ë°”êµ¬ë‹ˆ</h1>

    {% if cart_items %}
        <div class="row justify-content-center">
            <div class="col-md-8">
                <form id="cart-form">
                    {% for item in cart_items %}
                    <div class="card mb-3 shadow-sm cart-item" data-cart-id="{{ item.id }}">
                        <div class="row g-0">
                            <!-- ì²´í¬ë°•ìŠ¤ ì¶”ê°€ -->
                            <div class="col-md-1 d-flex align-items-center justify-content-center">
                                <input type="checkbox" name="selected_items" value="{{ item.id }}" class="form-check-input" onchange="calculateTotal()">
                            </div>

                            <!-- ìƒí’ˆ ì´ë¯¸ì§€ -->
                            <div class="col-md-3 text-center p-2">
                                <img src="{{ item.product.image_url }}" class="img-fluid rounded" alt="{{ item.product.name }}">
                            </div>

                            <!-- ìƒí’ˆ ì •ë³´ -->
                            <div class="col-md-8">
                                <div class="card-body">
                                    <h4 class="card-title">{{ item.product.name }}</h4>
                                    <p class="fw-bold text-primary">
                                        ğŸ’° <span id="item-price-{{ item.id }}" data-unit-price="{{ item.product.price|int }}">
                                            {{ (item.product.price * item.quantity)|int }}ì›
                                        </span>
                                    </p>
                                    <p class="fw-bold">ìˆ˜ëŸ‰:
                                        <input type="number" class="form-control d-inline w-25" value="{{ item.quantity }}"
                                               min="1" onchange="updateQuantity({{ item.id }}, this.value)">
                                    </p>

                                    <!-- ì‚­ì œ ë²„íŠ¼ (AJAX ë°©ì‹) -->
                                    <button type="button" class="btn btn-outline-danger btn-sm remove-from-cart" data-cart-id="{{ item.id }}">
                                        âŒ ì‚­ì œ
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}

                    <!-- ì„ íƒí•œ ìƒí’ˆ ê°€ê²© ì´í•© UI ê°œì„  -->
                    <div class="text-center mt-4 p-3 border rounded shadow-sm bg-light">
                        <h4 class="fw-bold text-dark">
                            ğŸ’° ì´ ê²°ì œ ê¸ˆì•¡:
                            <span id="total-price" class="text-danger fs-3 fw-bold">0</span>ì›
                        </h4>
                    </div>

                    <!-- ì„ íƒí•œ ìƒí’ˆë§Œ ê²°ì œ -->
                    <div class="text-center mt-3">
                        <button type="button" class="btn btn-primary w-100" onclick="startSelectedCartPayment()">
                            ğŸ’³ ì„ íƒí•œ ìƒí’ˆë§Œ ê²°ì œí•˜ê¸°
                        </button>
                    </div>
                </form>

                <!-- ì¥ë°”êµ¬ë‹ˆ ë¹„ìš°ê¸° -->
                <form action="{{ url_for('cart_routes.clear_cart') }}" method="POST" class="text-center mt-3">
                    <button type="submit" class="btn btn-danger w-100">ğŸ—‘ ì¥ë°”êµ¬ë‹ˆ ë¹„ìš°ê¸°</button>
                </form>
            </div>
        </div>
    {% else %}
        <div class="text-center mt-5">
            <p class="fs-4 text-muted">ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤. ğŸ›</p>
            <a href="{{ url_for('product_routes.product_list') }}" class="btn btn-primary">ğŸ“¢ ìƒí’ˆ ë³´ëŸ¬ê°€ê¸°</a>
        </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
    <script src="{{ url_for('static', filename='js/cart.js') }}"></script>
    <script src="{{ url_for('static', filename='js/payment.js') }}"></script>
{% endblock %}
